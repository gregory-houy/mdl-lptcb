<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prix - MDL du Lycée</title>
    <link rel="stylesheet" href="style.css">
    <link rel="website icon" type="png" href="images/logos/mdl-onglet.png">
</head>
<body>
    <header>
        <nav>
            <div class="logo"><a href="index.html"><img src="/images/logos/mdl-lycee-sombre.png" alt="logo"></a></div>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="prix.html" class="active">Prix</a></li>
                <li><a href="gestion_prix.html">Gestion</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <h1>Les Prix</h1>
        <p>
            Pour bénéficier des prix adhérents, vous pouvez vous inscrire : 
            <a href="http://adhesion-mdl-lptcb.vercel.app/" target="_blank"><b>Bénéficier des prix adhérents</b></a>
        </p>
        <section id="section-prix">
            <p><i>Chargement des prix...</i></p>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 MDL du Lycée Château Blanc</p>
    </footer>

    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script>
        const supabaseUrl = "https://iarukjyswplvmtcxjtbx.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhcnVranlzd3Bsdm10Y3hqdGJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNTYwMjUsImV4cCI6MjA3MTYzMjAyNX0.jC33JZm5vwOROpxEMBCRQTaGwe-TF06fRMHg1UcoHxY";
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function chargerPrix() {
            const { data, error } = await supabase
                .from("prix")
                .select("*")
                .order("categorie", { ascending: true });

            const container = document.getElementById("section-prix");

            if (error) {
                container.innerHTML = "<p>❌ Erreur de chargement</p>";
                console.error(error);
                return;
            }

            if (!data || data.length === 0) {
                container.innerHTML = "<p>Aucun prix défini.</p>";
                return;
            }

            // Grouper par catégorie
            const categories = {};
            data.forEach(item => {
                if (!categories[item.categorie]) categories[item.categorie] = [];
                categories[item.categorie].push(item);
            });

            // Générer les sections
            container.innerHTML = "";
            for (const [categorie, produits] of Object.entries(categories)) {
                let html = `
                    <section>
                        <h2>${categorie}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Prix Adhérent</th>
                                    <th>Prix Non-Adhérent</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                produits.forEach(p => {
                    html += `
                        <tr>
                            <td>${p.nom}</td>
                            <td>${p.prix_adherent !== null ? p.prix_adherent + " €" : "Non défini"}</td>
                            <td>${p.prix_non_adherent !== null ? p.prix_non_adherent + " €" : "Non défini"}</td>
                        </tr>
                    `;
                });
                html += `</tbody></table></section>`;
                container.innerHTML += html;
            }
        }

        chargerPrix();
    </script>
</body>
</html>
